{% extends 'trading/base.html' %}

{% block title %}Modify Order - NeoTrade{% endblock %}

{% block content %}
<style>
  .container {
    max-width: 680px;
    width: 100%;
    margin: 0 auto;
    animation: fadeIn 0.8s ease-in-out;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .dashboard-title {
    text-align: center;
    margin-bottom: 24px;
    color: var(--accent);
    font-size: 2rem;
  }
</style>

<div class="container">
  <h2 class="dashboard-title">Modify Order</h2>
  <div class="card">
    <h4 class="text-center" style="margin-bottom: 16px;">Edit Order Quantity</h4>
    <form id="modify-order-form">
      <div class="form-group">
        <label for="order-id">Order ID</label>
        <input type="number" class="form-control" id="order-id" name="order-id" required>
      </div>
      <div class="form-group">
        <label for="quantity">Quantity</label>
        <input type="number" class="form-control" id="quantity" name="quantity" required>
      </div>
      <div class="form-group">
        <label for="disclose">Disclosed Quantity</label>
        <input type="number" class="form-control" id="disclose" name="disclose" required>
      </div>
      <div class="form-group">
        <label for="price">Price</label>
        <input type="number" step="0.01" class="form-control" id="price" name="price" required>
      </div>
      <button type="submit" class="btn" style="width: 100%;">Save Changes</button>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('modify-order-form');

    form.addEventListener('submit', function (event) {
      event.preventDefault();

      const orderId = document.getElementById('order-id').value;
      const quantity = document.getElementById('quantity').value;
      const discloseQ = document.getElementById('disclose').value;
      const price = document.getElementById('price').value;

      if (!orderId || !quantity || !price || isNaN(orderId) || isNaN(quantity) || isNaN(discloseQ) || isNaN(price)) {
        alert('Please enter valid values for Order ID, Quantity, Disclosed Quantity and Price.');
        return;
      }

      const payload = {
        order_id: parseInt(orderId),
        quantity: parseInt(quantity),
        disclosed_quantity: parseInt(discloseQ),
        price: parseFloat(price)
      };

      fetch('{% url "update_prev_order" %}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify(payload),
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Order updated successfully!');
        } else {
          alert('Error updating order: ' + (data.message || 'Unknown error'));
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('There was an error updating the order.');
      });
    });
  });
</script>
{% endblock %}
</body>
</html>
